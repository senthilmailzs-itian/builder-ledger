# BUILDER LEDGER – FINAL DETAILED MASTER PROMPT (V1.1 LOCKED) - START

YOU ARE A SENIOR SOFTWARE ARCHITECT AND ELECTRON.JS EXPERT.

I WANT TO DESIGN AND DOCUMENT FROM SCRATCH AN OFFLINE-FIRST DESKTOP APPLICATION CALLED “BUILDER LEDGER” (PROJECT NAME: builder-ledger).

THIS PROMPT IS THE SINGLE SOURCE OF TRUTH.
DO NOT INTRODUCE ASSUMPTIONS.
DO NOT ADD FEATURES.
DO NOT GENERATE APPLICATION SOURCE CODE.
GENERATE DESIGN AND DOCUMENTATION ONLY.

=================================================
INTERNET USAGE CLARIFICATION (FINAL)
=================================================

Internet access is ALLOWED during DEVELOPMENT AND BUILD TIME for:
- Downloading Node.js, Electron, and dependencies
- Using Git / GitHub
- Using GitHub Copilot
- Installing npm packages

At application runtime, the Builder Ledger application MUST NOT
initiate, depend on, or perform any network or internet communication.
The application must function correctly regardless of whether the host
system has internet connectivity enabled or disabled.
The application MUST NOT require the system’s internet access to be
disabled in order to operate correctly.

=================================================
NON-NEGOTIABLE CONSTRAINTS (FINAL & LOCKED)
=================================================

- The application MUST operate 100% OFFLINE at runtime
- No cloud, no internet usage by the application itself
- Desktop application using Electron ONLY
- UI using HTML + Bootstrap ONLY (Bootstrap must be local, NOT CDN)
- Database using SQLite ONLY (single local .db file)
- Platform: Windows ONLY (V1)
- Code must be clean, maintainable, migration-ready
- Security-first, vulnerability-minimized design

=================================================
PLATFORM & PACKAGING (FINAL & LOCKED)
=================================================

Target architecture:
- Windows x64 ONLY

Supported OS:
- Windows 10 (64-bit)
- Windows 11 (64-bit)

Installation model:
- Machine-wide installer (.exe)
- Administrator rights required ONLY during installation
- After installation, application runs for ALL Windows users
- NO admin rights required to run the application

Application binaries location:
C:\Program Files\Builder Ledger\

Shared application data location:
C:\ProgramData\BuilderLedger\
  data\builder-ledger.db
  backups\
  logs\
  attachments\

Data access model:
- Single shared SQLite database
- Shared by all Windows users
- Database, backups, logs, and attachments are common and synchronized
- File permissions configured during installation

=================================================
AUTHENTICATION & SESSION (FINAL)
=================================================

- Local authentication only
- Username + password / PIN
- Passwords stored as secure hashes (bcrypt or equivalent)
- Session stored ONLY in application memory
- Session cleared on application restart
- NO JWT
- NO cookies
- NO localStorage
- NO sessionStorage
- NO remember-me functionality

=================================================
ROLE MODEL (FINAL & LOCKED)
=================================================

ONLY these three roles exist:
- ADMIN
- ACCOUNTANT
- REPORT_VIEWER

Rules:
- Each user has exactly one role
- Role assigned by ADMIN
- No role inheritance
- No multi-role users
- Authorization enforced ONLY in SERVICE layer
- UI visibility is defensive only, never authoritative

=================================================
DOMAIN & LEDGER MODEL (FINAL)
=================================================

- Project (mandatory for every ledger entry)
- Shop (vendor / supplier only)
- Category (PAYMENT / EXPENSE)

Ledger rules:
- ONE transaction table only: ledger_entries
- No history tables
- No balance tables
- Soft delete only
- All balances are DERIVED, never stored

=================================================
PAYMENT SYSTEM (V1.1 FINAL)
=================================================

Payment categories:

1. Payment Received
   - Customer to Builder
   - Money IN
   - Shop MUST be NULL

2. Shop Payment
   - Builder to Shop
   - Money OUT
   - Shop REQUIRED
   - Shop MUST be ACTIVE
   - Payment details REQUIRED

3. Refund to Customer
   - Builder to Customer
   - Money OUT
   - Shop MUST be NULL
   - Project MUST be ACTIVE
   - Allowed ONLY if project balance > 0
   - Payment details REQUIRED

Expense categories:
- Cement, Steel, Labor, etc.
- Shop OPTIONAL

=================================================
ACTION DATE & TIMESTAMP STANDARD (FINAL)
=================================================

- Business date field: action_date
- Mandatory for ALL ledger entries
- Represents when the financial action occurred
- ALL timestamps generated by application layer ONLY
- Explicit timezone: Asia/Kolkata (IST)
- ISO-8601 with timezone offset
- NO database-generated timestamps
- NO triggers

Applies to:
- action_date
- created_at
- updated_at
- changed_at
- triggered_at

=================================================
ATTACHMENTS (V1.1 FINAL)
=================================================

- Allowed for ANY ledger entry
- Supported formats: JPG, PNG, PDF
- Max 5 files per entry
- Max 5 MB per file

Storage:
C:\ProgramData\BuilderLedger\attachments\{year}\{month}\{ledger_entry_id}\

Rules:
- Database stores RELATIVE paths only
- Attachments are immutable
- No automatic file deletion on soft delete

=================================================
AUDIT, BACKUP & LOGGING (FINAL)
=================================================

Audit:
- ONLY for ledger_entries
- Table: ledger_audit_trail
- Handled ONLY in service layer
- No triggers
- Immutable records

Backup:
- SQLite DB is single source of truth
- File-level backups only
- AUTO weekly (retain last 8)
- ON-DEMAND (ADMIN only)
- Failure must NOT block app

Logging:
- Local file-based logging
- Daily rotation
- Retain last 30 days
- No sensitive data

=================================================
ARCHITECTURE REQUIREMENTS (FINAL)
=================================================

UI → IPC Controllers → Services → Repositories → DB Adapter

Rules:
- No SQL in Services
- Authorization ONLY in Service layer
- No business logic in UI
- Repository pattern mandatory
- Foreign keys ON
- WAL mode ON
- contextIsolation = true
- nodeIntegration = false

=================================================
IMPLEMENTATION PLAN SCOPE (FINAL – OPTION B)
=================================================

The Detailed Implementation Plan MUST:
- Focus ONLY on phase-wise DEVELOPMENT activities
- Define feature scope, sequencing, and dependencies
- Be suitable for Copilot-driven execution

The Implementation Plan MUST NOT:
- Introduce separate Testing phases
- Introduce UAT or business validation phases
- Introduce Documentation or Release phases
- Mandate testing frameworks or coverage

Testing, UAT, and documentation are OUT OF SCOPE
for the V1 Implementation Plan.

=================================================
DOCUMENTATION SCOPE (LEAN & FINAL)
=================================================

Generate DESIGN AND DOCUMENTATION ONLY.
NO application source code.
NO JavaScript.
NO SQL.
NO tests.
NO configuration files.

=================================================
WHAT YOU MUST GENERATE (IMPORTANT DOCUMENTS ONLY)
=================================================

Generate ONLY the following PRODUCTION-READY documents:

1. Detailed Implementation Plan (phase-wise DEVELOPMENT ONLY)
2. High-Level Design (HLD)
3. Low-Level Design (LLD – design only)
4. Database Design + ERD (design-level)
5. Technical Prerequisites & Installation Guide
6. .github/copilot-instructions.md (rules only)

FOLLOW THIS PROMPT STRICTLY.
DO NOT DEVIATE.
DO NOT INTRODUCE NEW FEATURES.

# BUILDER LEDGER – FINAL DETAILED MASTER PROMPT (V1.1 LOCKED) - END